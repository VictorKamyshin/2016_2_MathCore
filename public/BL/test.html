<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Babylon - Basic scene</title>
    <style>
    body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    canvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }
    </style>
    <script src="babylon.js"></script>
    <script src="hand.js"></script>
  </head>
  <body>
  <canvas id="myCanvas"></canvas>
  <script type="text/javascript">
    var canvas = document.getElementById("myCanvas"); //берем нашу канву html
    var engine = new BABYLON.Engine(canvas, true); //загружаем 3D - движок

    var createScene = function(){
      var scene = new BABYLON.Scene(engine); //создали нашу сцену
      scene.clearColor = new BABYLON.Color3(0,0,0.5); //поменяли цвет сцены на белый

      var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI/2, Math.PI / 3, 12, BABYLON.Vector3.Zero(), scene);
      //var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 5, -10), scene); //создали свободную камеру в точке (0,5,-10)
      camera.setTarget(BABYLON.Vector3.Zero()); //нацелили камеру в начало координат сцены
      camera.attachControl(canvas, false); //присоединили камеру к канве

      var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene); //создали источник света (равномерный свет)
      light.intensity = .5; //установили интенсивность света

      var sphere = BABYLON.Mesh.CreateSphere("sphere1", 16, 1, scene); // создали сферу (все базовые объекты находятся в Mesh)
      sphere.position.x = -5; //очевидно
      sphere.position.y = 1;
      var redMaterial = new BABYLON.StandardMaterial("RedPirat",scene);
      redMaterial.diffuseColor = new BABYLON.Color3(1,0,0);
      sphere.material = redMaterial;


      //добавим skybox
      var skybox = BABYLON.Mesh.CreateBox("skyBox", 800.0, scene);
      var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
      skyboxMaterial.backFaceCulling = false;
      skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("sky", scene);
      skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
      skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
      skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
      skyboxMaterial.disableLighting = true;
      skybox.material = skyboxMaterial;

      //добавить движение сферы
      sphere.actionManager = new BABYLON.ActionManager(scene); //добавили менеджер событий
      sphere.actionManager.registerAction(new BABYLON.InterpolateValueAction(
        BABYLON.ActionManager.OnPickTrigger, sphere.material, "diffuse", BABYLON.Color3.Black(),1000))
        .then(new BABYLON.SetValueAction(BABYLON.ActionManager.NothingTrigger, sphere.material, "diffuse", BABYLON.Color3.Red()));


    //  var ground = BABYLON.Mesh.CreateGround("ground1", 6, 6, 2, scene); //создали плоскость

      //квадратное поле 10*10, разбитое на 121 плитку
      var xmin = -5,  zmin = -5;
      var xmax =  5,  zmax =  5;
      var precision = {
       "w" : 2,
       "h" : 2
      };
      var subdivisions = {
       'h' : 11,
       'w' : 11
      };

      var tiledGround = new BABYLON.Mesh.CreateTiledGround("Tiled Ground", xmin, zmin, xmax, zmax, subdivisions, precision, scene);

      //материал светло-зеленого цвета
      var LightGreen = new BABYLON.StandardMaterial("LGreen", scene);
      LightGreen.diffuseColor = new BABYLON.Color3(0, 0.5, 0);
      //материал темно-зеленого цвета
      var DarkGreen = new BABYLON.StandardMaterial("DGreen", scene);
      DarkGreen.diffuseColor = new BABYLON.Color3(0, 1, 0);

      //сульти-материал, содержащий светлый и темный зеленые цвета
      var multimat = new BABYLON.MultiMaterial("multi", scene);
      multimat.subMaterials.push(LightGreen);
      multimat.subMaterials.push(DarkGreen);

      tiledGround.material = multimat; //добавили материал к нашей карте


      var verticesCount = tiledGround.getTotalVertices(); //количество вершин (этот момент не очнь понятен)
      var tileIndicesLength = tiledGround.getIndices().length / (subdivisions.w * subdivisions.h); //кол-во плиток

      //добавляем цветные плитки
      tiledGround.subMeshes = [];
      var base = 0;
      for (var row = 0; row < subdivisions.h; row++) {
          for (var col = 0; col < subdivisions.w; col++) {
                tiledGround.subMeshes.push(new BABYLON.SubMesh(row%2 ^ col%2,
                0, verticesCount, base , tileIndicesLength, tiledGround));
                base += tileIndicesLength;
          }
      }

      //var squareField = BABYLON.Mesh.CreateDisc("field",11,4,scene,false);
      //со сценой закончили
      return scene;
    }

    var scene = createScene(); //создали сцену (вместе с камерой, светом и несколькими объектами)

    //самый главный цикл - цикл рендеринга (отрисовка растр. изображения 60 t per sec)
    engine.runRenderLoop(function () {
      scene.render();
    })

    //обработчик для изменения размеров окна (масштабирование)
    window.addEventListener("resize", function () {
      engine.resize();
    });

  </script>
  </body>
</html>
